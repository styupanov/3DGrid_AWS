import { Cartesian3 } from 'cesium';

const CONFIG = {
  1: {
    pc_build3d: ['0-1', '1-10', '10-20', '20-30', '30-40', '40-50', '50-65', '65-80', '88-95', '95-100'],
    pc_roads_3d: ['0-3', '3-12', '12-25', '25-38', '38-51', '51-62', '62-73', '73-85', '85-95', '95-100'],
    LST: ['28-29', '29-30', '30-31', '31-31.5', '31.5-32', '32-32.5', '32.5-33', '33-33.3', '33.3-33.6', '33.5-34'],
    NDVI: ['0-0.01', '0.01-0.02', '0.02-0.03', '0.03-0.04', '0.04-0.05', '0.05-0.07', '0.07-0.1', '0.1-0.114', '0.14-0.16', '0.16-0.27'],
    pc_green3d: ['0-0', '0-100'],
    AQI: ['82-84', '84-86', '86-88', '88-90', '90-92', '92-94', '94-96', '96-99', '99-102', '102-107'],
    TJ: ['0.2-0.7', '0.7-1.5', '1.5-2.2', '2.2-2.8', '2.8-3.2', '3.2-3.8', '3.8-4.5', '4.5-5.1', '5.1-5.8', '5.8-6.3'],
    WATER_VOL_SHARE: ['0-0']
  },
  2: {
    pc_build3d: ['0-7', '7-16', '16-25', '25-35', '35-45', '45-55', '55-67', '67-78', '78-90', '90-100'],
    pc_roads_3d: ['0-2', '2-7', '7-12', '12-18', '18-25', '25-32', '32-40', '40-50', '50-66', '66-100'],
    LST: ['28-31', '31-32', '32-32.6', '32.6-33', '33-33.8', '33.8-34.4', '34.4-35', '35-36', '36-37', '37-40'],
    NDVI: ['0-0.05', '0.05-0.07', '0.07-0.1', '0.1-0.13', '0.13-0.17', '0.17-0.22', '0.22-0.3', '0.3-0.37', '0.37-0.47', '0.47-0.68'],
    pc_green3d: ['0-2', '2-6', '6-9', '9-13', '13-17', '17-23', '23-30', '30-40', '40-50', '50-100'],
    AQI: ['83-83.8', '83.8-85.4', '85.4-87.3', '87.3-89', '89-91', '91-92', '92-94', '94-97', '97-101', '101-115'],
    TJ: ['0.2-0.4', '0.4-0.8', '0.8-1.1', '1.1-1.3', '1.3-1.5', '1.5-1.8', '1.8-2.1', '2.1-2.6', '2.6-3.3', '3.3-7.6'],
    WATER_VOL_SHARE: ['0-1', '1-2', '2-3', '3-5', '5-6', '6-8', '8-10', '10-12', '12-13', '13-15']
  },
  3: {
    pc_build3d: ['0-0.01', '0.01-0.03', '0.03-0.06', '0.06-0.08', '0.08-0.12', '0.12-0.16', '0.16-0.23', '0.23-0.35', '0.35-0.56', '0.56-1'],
    pc_roads_3d: ['0-0.2', '0.2-0.3', '0.3-0.5', '0.5-0.7', '0.7-1', '1-1.3', '1.3-1.7', '1.7-2.2', '2.2-3', '3-6'],
    LST: ['26-29', '29-31', '31-32', '32-33', '33-34', '34-34.5', '34.5-35', '35-36', '36-37', '37-41'],
    NDVI: ['0-0.05', '0.05-0.08', '0.08-0.1', '0.1-0.14', '0.14-0.17', '0.17-0.21', '0.21-0.27', '0.27-0.34', '0.34-0.44', '0.44-0.64'],
    pc_green3d: ['0-0.5', '0.5-2', '2-3.5', '3.5-5.8', '5.8-8.8', '8.8-12.4', '12.4-17', '17-21.2', '21.2-26.6', '26.6-34'],
    AQI: ['83-83.1', '83.1-87', '87-87.5', '87.5-87.7', '87.7-87.9', '87.9-88.1', '88.1-88.2', '88.2-88.3', '88.3-88.5', '88.5-90'],
    TJ: ['0-0.2', '0.2-0.3', '0.3-0.9', '0.9-1', '1-1.1', '1.1-1.2', '1.2-1.3'],
    WATER_VOL_SHARE: ['0-0.05', '0.05-0.15', '0.15-0.26', '0.26-0.37', '0.37-0.5', '0.5-0.7', '0.7-1', '1-1.2', '1.2-1.4', '1.4-1.6']
  },
  4: {
    pc_build3d: ['0-0.0005', '0.0005-0.001', '0.001-0.002', '0.002-0.003', '0.003-0.005', '0.005-0.006', '0.006-0.008', '0.008-0.01', '0.001-0.013', '0.013-0.02'],
    pc_roads_3d: ['0-0.01', '0.01-0.02', '0.02-0.03', '0.03-0.05', '0.05-0.07', '0.07-0.08', '0.08-0.1', '0.1-0.12', '0.12-0.15', '0.15-0.21'],
    LST: ['26-28', '28-30.6', '30.6-32', '32-33', '33-34', '34-34.5', '34.5-35', '35-35.7', '35.7-36', '36-37.8'],
    NDVI: ['0-0.045', '0.045-0.07', '0.07-0.09', '0.09-0.1', '0.1-0.13', '0.13-0.15', '0.15-0.19', '0.19-0.23', '0.23-0.3', '0.3-0.57'],
    pc_green3d: ['0-0.02', '0.02-0.06', '0.06-0.12', '0.12-0.2', '0.2-0.3', '0.3-0.45', '0.45-0.6', '0.6-0.8', '0.8-1', '1-1.4'],
    AQI: ['83-84', '84-87', '87-87.5', '87.5-87', '87-87.9', '87.9-88', '88-88.1', '88.1-88.2', '88.2-88.4', '88.4-88.7'],
    TJ: ['0.2-0.2', '0.2-0.9', '0.9-1', '1-1.1', '1.1-1.2'],
    WATER_VOL_SHARE: ['0-0.003', '0.003-0.008', '0.008-0.016', '0.016-0.027', '0.027-0.04', '0.04-0.05', '0.05-0.08', '0.08-0.1', '0.1-0.13', '0.13-0.16']
  },
  5: {
    pc_build3d: ['0-0.001', '0.001-0.004', '0.004-0.007', '0.007-0.01', '0.01-0.013', '0.013-0.017', '0.017-0.021', '0.021-0.026', '0.026-0.036', '0.036-0.046'],
    pc_roads_3d: ['0-0.0002', '0.0002-0.001', '0.001-0.0017', '0.0017-0.002', '0.002-0.003', '0.003-0.0035', '0.0035-0.004', '0.004-0.0054', '0.0054-0.0065', '0.0065-0.0075'],
    LST: ['30-31', '31-33', '33-33.5', '33.5-34', '34-34.3', '34.3-34.6', '34.6-35', '35-35.5', '35.5-35.7', '35.7-36.5'],
    NDVI: ['0-0.07', '0.07-0.08', '0.08-0.09', '0.09-0.1', '0.1-0.11', '0.11-0.12', '0.12-0.13', '0.13-0.14', '0.14-0.15', '0.15-0.17'],
    pc_green3d: ['0-0.0002', '0.0002-0.0007', '0.0007-0.0017', '0.0017-0.0025', '0.0025-0.004', '0.004-0.005', '0.005-0.006', '0.006-0.009', '0.009-0.014', '0.014-0.019'],
    AQI: ['82-83', '83-87.5', '87.5-87.8', '87.8-87.9', '87.9-88', '88-88.1', '88.1-88.12', '88.12-88.17', '88.17-88.27', '88.27-88.35'],
    TJ: ['0-1', '1-1.1'],
    WATER_VOL_SHARE: ['0-0.00002', '0.00002-0.00005', '0.00005-0.00008', '0.00008-0.00014', '0.00014-0.00018', '0.00018-0.0003', '0.0003-0.00037', '0.00037-0.00049', '0.00049-0.00086', '0.00086-0.00154']
  }
}

const newConfig = {
  1: {
    pc_build3d: {
      min: 0, max: 100,
      step: 1,
      thresholds: ['0', '1', '10', '20', '30', '40', '50', '65', '80', '95', '100'],
      labels: ['0', '1', '10', '20', '30', '40', '50', '65', '80', '95', '100']
    },
    pc_roads_3d: {
      min: 0, max: 100,
      step: 1,
      thresholds: ['0', '3', '12', '25', '38', '51', '62', '73', '85', '95', '100'],
      labels: ['0', '3', '12', '25', '38', '51', '62', '73', '85', '95', '100'] },
    LST: { min: 0, max: 34, step: 0.1, thresholds: ['28', '29', '30', '31', '31.5', '32', '32.5', '33', '33.3', '33.6', '34'], labels: ['28', '29', '30', '31', '31.5', '32', '32.5', '33', '33.3', '33.6', '34'] },
    NDVI: { min: 0, max: 0.27, step: 0.01, thresholds: ['0', '0.01', '0.02', '0.03', '0.04', '0.05', '0.07', '0.1', '0.114', '0.14', '0.16', '0.27'], labels: ['0', '0.01', '0.02', '0.03', '0.04', '0.05', '0.07', '0.1', '0.114', '0.14', '0.16', '0.27'] },
    pc_green3d: { min: 0, max: 100, step: 1, thresholds: ['0', '100'], labels: ['0', '100'] },
    AQI: { min: 0, max: 107, step: 1, thresholds: ['82', '84', '86', '88', '90', '92', '94', '96', '99', '102', '107'], labels: ['82', '84', '86', '88', '90', '92', '94', '96', '99', '102', '107'] },
    TJ: { min: 0, max: 6.3, step: 0.1, thresholds: ['0.2', '0.7', '1.5', '2.2', '2.8', '3.2', '3.8', '4.5', '5.1', '5.8', '6.3'], labels: ['0.2', '0.7', '1.5', '2.2', '2.8', '3.2', '3.8', '4.5', '5.1', '5.8', '6.3'] },
    pc_water3d: { min: 0, max: 0, step: 0, thresholds: ['0'], labels: ['0'] },
  },
  2: {
    pc_build3d: {
      min: 0, max: 100,
      step: 1,
      thresholds: ['0', '7', '16', '25', '35', '45', '55', '67', '78', '90', '100'],
      labels: ['0', '7', '16', '25', '35', '45', '55', '67', '78', '90', '100'] },
    pc_roads_3d: {
      min: 0, max: 100,
      step: 1,
      thresholds: ['0', '2', '7', '12', '18', '25', '32', '40', '50', '66', '100'],
      labels: ['0', '2', '7', '12', '18', '25', '32', '40', '50', '66', '100']
    },
    LST: {
      min: 0, max: 40,
      step: 0.1,
      thresholds: ['28', '31', '32', '32.6', '33', '33.8', '34.4', '35', '36', '37', '40'],
      labels: ['28', '31', '32', '32.6', '33', '33.8', '34.4', '35', '36', '37', '40']
    },
    NDVI: {
      min: 0, max: 0.68,
      step: 0.01,
      thresholds: ['0', '0.05', '0.07', '0.1', '0.13', '0.17', '0.22', '0.3', '0.37', '0.47', '0.68'],
      labels: ['0', '0.05', '0.07', '0.1', '0.13', '0.17', '0.22', '0.3', '0.37', '0.47', '0.68']
    },
    pc_green3d: {
      min: 0, max: 100,
      step: 1,
      thresholds: ['0', '2', '6', '9', '13', '17', '23', '30', '40', '50', '100'],
      labels: ['0', '2', '6', '9', '13', '17', '23', '30', '40', '50', '100']
    },
    AQI: {
      min: 0, max: 115,
      step: 1,
      thresholds: ['83', '83.8', '85.4', '87.3', '89', '91', '92', '94', '97', '101', '115'],
      labels: ['83', '83.8', '85.4', '87.3', '89', '91', '92', '94', '97', '101', '115']
    },
    TJ: {
      min: 0, max: 7.6,
      step: 0.1,
      thresholds: ['0.2', '0.4', '0.8', '1.1', '1.3', '1.5', '1.8', '2.1', '2.6', '3.3', '7.6'],
      labels: ['0.2', '0.4', '0.8', '1.1', '1.3', '1.5', '1.8', '2.1', '2.6', '3.3', '7.6']
    },
    pc_water3d: {
      min: 0, max: 15,
      step: 1,
      thresholds: ['0', '1', '2', '3', '5', '6', '8', '10', '12', '13', '40'],
      labels: ['0', '1', '2', '3', '5', '6', '8', '10', '12', '13', '40']
    },
  },
  3: {
    pc_build3d: {
      min: 0, max: 1,
      step: 0.01,
      thresholds: ['0', '0.01', '0.03', '0.06', '0.08', '0.12', '0.16', '0.23', '0.35', '0.56', '1'],
      labels:    ['0', '0.01', '0.03', '0.06', '0.08', '0.12', '0.16', '0.23', '0.35', '0.56', '1']
    },
    pc_roads_3d: {
      min: 0, max: 6,
      step: 0.1,
      thresholds: ['0', '0.2', '0.3', '0.5', '0.7', '1', '1.3', '1.7', '2.2', '3', '6'],
      labels:    ['0', '0.2', '0.3', '0.5', '0.7', '1', '1.3', '1.7', '2.2', '3', '6']
    },
    LST: {
      min: 0, max: 41,
      step: 0.1,
      thresholds: ['26', '29', '31', '32', '33', '34', '34.5', '35', '36', '37', '41'],
      labels:    ['26', '29', '31', '32', '33', '34', '34.5', '35', '36', '37', '41']
    },
    NDVI: {
      min: 0, max: 0.64,
      step: 0.01,
      thresholds: ['0', '0.05', '0.08', '0.1', '0.14', '0.17', '0.21', '0.27', '0.34', '0.44', '0.64'],
      labels:    ['0', '0.05', '0.08', '0.1', '0.14', '0.17', '0.21', '0.27', '0.34', '0.44', '0.64']
    },
    pc_green3d: {
      min: 0, max: 34, step: 0.1,
      thresholds: ['0', '0.5', '2', '3.5', '5.8', '8.8', '12.4', '17', '21.2', '26.6', '34'],
      labels:    ['0', '0.5', '2', '3.5', '5.8', '8.8', '12.4', '17', '21.2', '26.6', '34']
    },
    AQI: {
      min: 0, max: 90, step: 0.1,
      thresholds: ['83', '83.1', '87', '87.5', '87.7', '87.9', '88.1', '88.2', '88.3', '88.5', '90'],
      labels:    ['83', '83.1', '87', '87.5', '87.7', '87.9', '88.1', '88.2', '88.3', '88.5', '90']
    },
    TJ: {
      min: 0, max: 1.3, step: 0.01,
      thresholds: ['0', '0.2', '0.3', '0.9', '1', '1.1', '1.2', '1.23', '1.26', '1.28', '1.3'],
      labels:    ['0', '0.2', '0.3', '0.9', '1', '1.1', '1.2', '1.23', '1.26', '1.28', '1.3']
    },
    pc_water3d: {
      min: 0, max: 1.6, step: 0.01,
      thresholds: ['0', '0.05', '0.15', '0.26', '0.37', '0.5', '0.7', '1', '1.2', '1.4', '1.6'],
      labels:    ['0', '0.05', '0.15', '0.26', '0.37', '0.5', '0.7', '1', '1.2', '1.4', '1.6']
    }
  },
  4: {
    pc_build3d: {
      min: 0, max: 0.02, step: 0.0001,
      thresholds: ['0', '0.0005', '0.001', '0.002', '0.003', '0.005', '0.006', '0.008', '0.01', '0.013', '0.02'],
      labels:    ['0', '0.0005', '0.001', '0.002', '0.003', '0.005', '0.006', '0.008', '0.01', '0.013', '0.02']
    },
    pc_roads_3d: {
      min: 0, max: 0.21, step: 0.001,
      thresholds: ['0', '0.01', '0.02', '0.03', '0.05', '0.07', '0.08', '0.1', '0.12', '0.15', '0.21'],
      labels:    ['0', '0.01', '0.02', '0.03', '0.05', '0.07', '0.08', '0.1', '0.12', '0.15', '0.21']
    },
    LST: {
      min: 0, max: 37.8, step: 0.1,
      thresholds: ['26', '28', '30.6', '32', '33', '34', '34.5', '35', '35.7', '36', '37.8'],
      labels:    ['26', '28', '30.6', '32', '33', '34', '34.5', '35', '35.7', '36', '37.8']
    },
    NDVI: {
      min: 0, max: 0.57, step: 0.01,
      thresholds: ['0', '0.045', '0.07', '0.09', '0.1', '0.13', '0.15', '0.19', '0.23', '0.3', '0.57'],
      labels:    ['0', '0.045', '0.07', '0.09', '0.1', '0.13', '0.15', '0.19', '0.23', '0.3', '0.57']
    },
    pc_green3d: {
      min: 0, max: 1.4, step: 0.01,
      thresholds: ['0', '0.02', '0.06', '0.12', '0.2', '0.3', '0.45', '0.6', '0.8', '1', '1.4'],
      labels:    ['0', '0.02', '0.06', '0.12', '0.2', '0.3', '0.45', '0.6', '0.8', '1', '1.4']
    },
    AQI: {
      min: 0, max: 88.7, step: 0.1,
      thresholds: ['83', '84', '87', '87.5', '87', '87.9', '88', '88.1', '88.2', '88.4', '88.7'],
      labels:    ['83', '84', '87', '87.5', '87', '87.9', '88', '88.1', '88.2', '88.4', '88.7']
    },
    TJ: {
      min: 0, max: 1.2, step: 0.01,
      thresholds: ['0.2', '0.2', '0.9', '1', '1.1', '1.12', '1.13', '1.15', '1.16', '1.17', '1.2'],
      labels:    ['0.2', '0.2', '0.9', '1', '1.1', '1.12', '1.13', '1.15', '1.16', '1.17', '1.2']
    },
    pc_water3d: {
      min: 0, max: 0.16, step: 0.001,
      thresholds: ['0', '0.003', '0.008', '0.016', '0.027', '0.04', '0.05', '0.08', '0.1', '0.13', '0.16'],
      labels:    ['0', '0.3', '0.8', '1.6', '2.7', '4', '5', '8', '10', '13', '16']
    }
  },
  5: {
    pc_build3d: {
      min: 0, max: 0.046, step: 0.0001,
      thresholds: ['0', '0.001', '0.004', '0.007', '0.01', '0.013', '0.017', '0.021', '0.026', '0.036', '0.046'],
      labels:    ['0', '10', '40', '70', '100', '130', '170', '210', '260', '360', '460']
    },
    pc_roads_3d: {
      min: 0, max: 0.0075, step: 0.0001,
      thresholds: ['0', '0.0002', '0.001', '0.0017', '0.002', '0.003', '0.0035', '0.004', '0.0054', '0.0065', '0.0075'],
      labels:    ['0', '2', '10', '17', '20', '30', '35', '40', '54', '65', '75']
    },
    LST: {
      min: 0, max: 36.5, step: 0.1,
      thresholds: ['30', '31', '33', '33.5', '34', '34.3', '34.6', '35', '35.5', '35.7', '36.5'],
      labels:    ['30', '31', '33', '33.5', '34', '34.3', '34.6', '35', '35.5', '35.7', '36.5']
    },
    NDVI: {
      min: 0, max: 0.17, step: 0.001,
      thresholds: ['0', '0.07', '0.08', '0.09', '0.1', '0.11', '0.12', '0.13', '0.14', '0.15', '0.17'],
      labels:    ['0', '0.07', '0.08', '0.09', '0.1', '0.11', '0.12', '0.13', '0.14', '0.15', '0.17']
    },
    pc_green3d: {
      min: 0, max: 0.019, step: 0.0001,
      thresholds: ['0', '0.0002', '0.0007', '0.0017', '0.0025', '0.004', '0.005', '0.006', '0.009', '0.014', '0.019'],
      labels:    ['0', '2', '7', '17', '25', '40', '50', '60', '90', '140', '190']
    },
    AQI: {
      min: 0, max: 88.35, step: 0.1,
      thresholds: ['82', '83', '87.5', '87.8', '87.9', '88', '88.1', '88.12', '88.17', '88.27', '88.35'],
      labels:    ['82', '83', '87.5', '87.8', '87.9', '88', '88.1', '88.12', '88.17', '88.27', '88.35']
    },
    TJ: {
      min: 0, max: 1.1, step: 0.01,
      thresholds: ['0', '1', '1.01', '1.02', '1.03', '1.04', '1.05', '1.06', '1.08', '1.09', '1.1'],
      labels:    ['0', '1', '1.01', '1.02', '1.03', '1.04', '1.05', '1.07', '1.08', '1.09', '1.1']
    },
    pc_water3d: {
      min: 0, max: 0.00154, step: 0.00001,
      thresholds: ['0', '0.00002', '0.00005', '0.00008', '0.00014', '0.00018', '0.0003', '0.00037', '0.00049', '0.00086', '0.00154'],
      labels:    ['0', '2', '5', '8', '14', '18', '30', '37', '49', '86', '154']
    }
  }
}

// export const getLevelConfig = (level, property) => {
//   const ranges = CONFIG[level]?.[property];
//   if (!ranges) return null;
//
//   const thresholds = [];
//   const labels = [];
//   let min = Infinity;
//   let max = -Infinity;
//
//   for (const range of ranges) {
//     const [start, end] = range.split("-").map(Number);
//     thresholds.push(start);
//     labels.push(`${start}-${end}`);
//
//     if (start < min) min = start;
//     if (end > max) max = end;
//   }
//
//   // Ð´Ð¾Ð±Ð°Ð²Ð¸Ð¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð¿Ð¾Ñ€Ð¾Ð³ ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾
//   thresholds.push(max);
//
//   const step = (max - min) / (ranges.length || 1);
//
//   return {
//     min,
//     max,
//     step,
//     thresholds: thresholds.map(String),
//     labels
//   };
// };
export const getLevelConfig = (level, property) => {
  const lvlCfg = newConfig[level]?.[property];
  if (!lvlCfg) {
    console.warn(`No config found for level ${level} and property ${property}`);
    return null;
  }

  return lvlCfg;
}

export function flyToFeature(viewer, feature, selectedLevel, level) {
  if (!viewer || !feature || typeof feature.getProperty !== 'function') {
    console.warn('ðŸ¤·â€â™‚ï¸ ÐÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ñ‹Ðµ viewer Ð¸Ð»Ð¸ feature');
    return;
  }

  console.log()

  const lon = parseFloat(feature.getProperty('Longitude'));
  const lat = parseFloat(feature.getProperty('Latitude'));
  const height = parseFloat(feature.getProperty('Height') || 0);

  if (isNaN(lon) || isNaN(lat)) {
    console.warn('ðŸ“‰ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ Ñ„Ð¸Ñ‡Ð¸');
    return;
  }

  const height_level = {
    5: 50645,
    4: 25089,
    3: 2004,
    2: 202,
    1: 253,
  }
  // Ð²Ñ‹ÑÐ¾Ñ‚Ð° ÐºÐ°Ð¼ÐµÑ€Ñ‹ Ð¾Ñ‚ Ð·ÑƒÐ¼Ð°:
  //
  const levelOffsets = {
    1: { offsetX: 0, offsetY: 0, offsetZ: -5000 },
    2: { offsetX: 0, offsetY: 0, offsetZ: -8000 },
    3: { offsetX: 0, offsetY: 0, offsetZ: -11000 },
    4: { offsetX: 0, offsetY: 0, offsetZ: -13000 },
    from5to4: { offsetX: 0, offsetY: 0, offsetZ: -22000 },
    from4to3: { offsetX: 0, offsetY: 0, offsetZ: -2200 },
    from3to2: { offsetX: 0, offsetY: 0, offsetZ: -200 },
    from1to2: { offsetX: 0, offsetY: 0, offsetZ: -200 },
    from2to3: { offsetX: 0, offsetY: 0, offsetZ: -2000 },
    from3to4: { offsetX: 0, offsetY: 0, offsetZ: -22000 },
    from4to5: { offsetX: 0, offsetY: 0, offsetZ: -50000 },
  };

  let offsets = {}

  if(level && selectedLevel){
    offsets = levelOffsets['from' + selectedLevel + 'to' + level]
  } else {
    offsets = { offsetX: 500, offsetY: 650, offsetZ: -500 }
  }
  level = level ?? 1;
  offsets = levelOffsets['from' + selectedLevel + 'to' + level]

  const {
    offsetX,
    offsetY,
    offsetZ,
    duration = 1.5
  } = { ...offsets }

  const target = Cartesian3.fromDegrees(lon, lat, height_level[level]);
  const offset = new Cartesian3(offsetX, offsetY, offsetZ);
  const destination = Cartesian3.add(target, offset, new Cartesian3());

  viewer.camera.flyTo({
    destination,
    duration,
    orientation: {
      heading: viewer.camera.heading,
      pitch: viewer.camera.pitch,
      roll: viewer.camera.roll
    }
  });

  console.log(`ðŸ›°ï¸ Flying to feature at [${lon}, ${lat}, ${height}]`);
}


// tileset.maximumScreenSpaceError = 8 // Ð£Ð²ÐµÐ»Ð¸Ñ‡ÑŒÑ‚Ðµ Ð´Ð»Ñ ÑÐ½Ð¸Ð¶ÐµÐ½Ð¸Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¸ Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
// tileset.maximumMemoryUsage = 512 // ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ð¼ÑÑ‚Ð¸ Ð² ÐœÐ‘
// tileset.cullWithChildrenBounds = true // Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÐµÐ½Ð½Ñ‹Ðµ Ð³Ñ€Ð°Ð½Ð¸Ñ†Ñ‹ Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ñ… Ñ‚Ð°Ð¹Ð»Ð¾Ð² Ð´Ð»Ñ Ð¾Ñ‚ÑÐµÑ‡ÐµÐ½Ð¸Ñ
// tileset.dynamicScreenSpaceError = true // Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ð¾ÑˆÐ¸Ð±ÐºÑƒ ÑÐºÑ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°
// tileset.dynamicScreenSpaceErrorDensity = 0.00278 // ÐŸÐ»Ð¾Ñ‚Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
// tileset.dynamicScreenSpaceErrorFactor = 4.0 // Ð¤Ð°ÐºÑ‚Ð¾Ñ€ Ð´Ð»Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
// tileset.dynamicScreenSpaceErrorHeightFalloff = 0.25 // ÐŸÐ°Ð´ÐµÐ½Ð¸Ðµ Ð²Ñ‹ÑÐ¾Ñ‚Ñ‹ Ð´Ð»Ñ Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸
// tileset.skipLevelOfDetail = true // ÐŸÑ€Ð¾Ð¿ÑƒÑÐº ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
// tileset.baseScreenSpaceError = 1024 // Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ð¾ÑˆÐ¸Ð±ÐºÐ° ÑÐºÑ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð°
// tileset.skipScreenSpaceErrorFactor = 16 // Ð¤Ð°ÐºÑ‚Ð¾Ñ€ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ° ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹
// tileset.skipLevels = 1 // ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°
// tileset.immediatelyLoadDesiredLevelOfDetail = false // ÐÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð°Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¶ÐµÐ»Ð°ÐµÐ¼Ð¾Ð³Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ Ð´ÐµÑ‚Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸
// tileset.loadSiblings = false // Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÑÐ¾ÑÐµÐ´Ð½Ð¸Ñ… Ñ‚Ð°Ð¹Ð»Ð¾Ð²
// tileset.foveatedScreenSpaceError = true // ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ‚Ð°Ð¹Ð»Ð¾Ð² Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ ÑÐºÑ€Ð°Ð½Ð°
// tileset.foveatedConeSize = 0.1 // Ð Ð°Ð·Ð¼ÐµÑ€ ÐºÐ¾Ð½ÑƒÑÐ° Ð´Ð»Ñ Ñ„Ð¾Ð²ÐµÐ°Ñ†Ð¸Ð¸
// tileset.foveatedMinimumScreenSpaceErrorRelaxation = 0.0 // ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÑÐ»Ð°Ð±Ð»ÐµÐ½Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÑÐºÑ€Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²Ð° Ð´Ð»Ñ Ñ„Ð¾Ð²ÐµÐ°Ñ†Ð¸Ð¸
// tileset.foveatedTimeDelay = 0.2 // Ð—Ð°Ð´ÐµÑ€Ð¶ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð´Ð»Ñ Ñ„Ð¾Ð²ÐµÐ°Ñ†Ð¸Ð¸

// ${pc_build3d} >= 0 && ${pc_build3d} <= 0.046 &&
// ${pc_green3d} >= 0 && ${pc_green3d} <= 0.046 &&
// ${pc_roads_3d} >= 0 && ${pc_roads_3d} <= 0.046 &&
// ${pc_water3d} >= 0 && ${pc_water3d} <= 0.046 &&
// ${LST} >= 0 && ${LST} <= 0.046 &&
// ${NDVI} >= 0 && ${NDVI} <= 0.046 &&
// ${AQI} >= 0 && ${AQI} <= 0.046 &&
// ${TJ} >= 0 && ${TJ} <= 0.046 + no zero